<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Requests</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="index.css">
    <style>
        /* Styling for posts */
.post {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    background-color: #f9f9f9;
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

/* Styling for post images */
.post-image {
    width: 150px;
    height: 150px;
    object-fit: cover; /* Ensures the image is cropped to fit the dimensions */
    border-radius: 5px;
}

/* Styling for post content */
.post-content {
    flex: 1; /* Allows the content to take up the remaining space */
}

/* Styling for post title */
.post-title {
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 10px;
}

/* Styling for post description */
.post-description {
    margin-bottom: 10px;
    font-size: 1em;
    color: #333;
}

/* Styling for poster information */
.post-poster {
    font-style: italic;
    font-size: 0.9em;
    color: #555;
    text-align: right;
}

/* Styling for delete button */
.delete-button {
    background-color: #ff4d4d;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    align-self: flex-end;
}

.delete-button:hover {
    background-color: #cc0000;
}
    </style>
</head>
<body class="requests">
    <h1 class="page-title">Request Forum</h1>
    <p class="page-subtitle">Welcome to your requests page.</p>

    <!-- Container to display posts -->
    <div id="postsContainer"></div>

    <script>
        // Firebase configuration (Ensure this matches your main config)
        const firebaseConfig = {
            apiKey: "AIzaSyAhcjMfi1p5YGyRiK14ux7gdYcEAYBXtGc",
            authDomain: "request-form-263db.firebaseapp.com",
            projectId: "request-form-263db",
            messagingSenderId: "729877304681",
            appId: "1:729877304681:web:3983c69cee3afd18ae59f8"
        };

        // Initialize Firebase (if not already initialized)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in.
                console.log("User is signed in:", user);
                loadPosts(user.uid); // Pass the user's ID to loadPosts
            } else {
                // No user is signed in.
                console.log("No user is signed in.");
                window.location.href = "index.html"; // Redirect to sign-in page
            }
        });

        function loadPosts(currentUserId) {
    const postsContainer = document.getElementById("postsContainer");
    postsContainer.innerHTML = ""; // Clear existing posts

    db.collection("posts").orderBy("timestamp", "desc").get()
        .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
                const post = doc.data();
                const postId = doc.id; // Get the document ID

                // Create post elements
                const postDiv = document.createElement("div");
                postDiv.classList.add("post");

                // Add the image if it exists
                if (post.imageUrl) {
                    const imageElement = document.createElement("img");
                    imageElement.classList.add("post-image");
                    imageElement.src = post.imageUrl; // Use the image URL
                    imageElement.alt = "Post Image"; // Add alt text for accessibility
                    postDiv.appendChild(imageElement);
                }

                const titleElement = document.createElement("h2");
                titleElement.classList.add("post-title");
                titleElement.textContent = post.title;
                postDiv.appendChild(titleElement);

                const descriptionElement = document.createElement("p");
                descriptionElement.classList.add("post-description");
                descriptionElement.textContent = post.description;
                postDiv.appendChild(descriptionElement);

                const posterElement = document.createElement("p");
                posterElement.classList.add("post-poster");
                posterElement.innerHTML = `Posted by: <a href="profileTemplate.html?userId=${post.posterId}">${post.posterName}</a>`;
                postDiv.appendChild(posterElement);

                // Add delete button if the current user is the creator of the post
                if (post.posterId === currentUserId) {
                    const deleteButton = document.createElement("button");
                    deleteButton.classList.add("delete-button");
                    deleteButton.textContent = "Delete Post";
                    deleteButton.onclick = () => deletePost(postId);
                    postDiv.appendChild(deleteButton);
                }

                postsContainer.appendChild(postDiv);
            });
        })
        .catch((error) => {
            console.error("Error getting posts: ", error);
        });
}
    </script>
</body>
</html>